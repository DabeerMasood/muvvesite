<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Semple FirebaseUI App</title>
       <script src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script>
  // Initialize Firebase
  // TODO: Replace with your project's customized code snippet
  var config = {
    apiKey: "AIzaSyCK_v-s-5I0aBllk6AtiOI1bvlfaBM5e5k",
    authDomain: "muvvefinal.firebaseapp.com",
    databaseURL: "https://muvvefinal.firebaseio.com",
    storageBucket: "<BUCKET>.appspot.com",
    messagingSenderId: "<SENDER_ID>",
  };
  firebase.initializeApp(config);
</script>

    <script type="text/javascript">
      initApp = function() {
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            // User is signed in.
            var displayName = user.displayName;
            var email = user.email;
            var emailVerified = user.emailVerified;
            var photoURL = user.photoURL;
            var uid = user.uid;
            var providerData = user.providerData;
            user.getToken().then(function(accessToken) {
              //image
              var img = document.createElement("IMG");
              img.src = user.photoURL;
              document.getElementById('imageDiv').appendChild(img);
              //image end
              //name
              document.getElementById('Name').textContent = user.displayName;
              //name end
              //document.getElementById('sign-in-status').textContent = 'Signed in';
              //document.getElementById('sign-in').textContent = 'Sign out';
              /*document.getElementById('account-details').textContent = JSON.stringify({
                displayName: displayName,
                email: email,
                emailVerified: emailVerified,
                photoURL: photoURL,
                uid: uid,
                accessToken: accessToken,
                providerData: providerData
              }, null, '  ');*/
              
             
              
            });
		  
	
	
          } else {
            // User is signed out.
            document.getElementById('sign-in-status').textContent = 'Signed out';
            document.getElementById('sign-in').textContent = 'Sign in';
            document.getElementById('account-details').textContent = 'null';
          }
        }, function(error) {
          console.log(error);
        });
      };
      
      window.addEventListener('load', function() {
        initApp()
      });
    </script>
	  
    
    
  </head>
  <body>
    <h1>Muvve</h1>
    <!--<div id="sign-in-status"></div>
    <div id="sign-in"></div>
    <div id="account-details"></div>-->
    <h2>Welcomea</h2>
    <div id="Name"></div>
    <div id="imageDiv"></div>
    <div class="signup">
    <h2 class="signup-title">Sign up for beata</h2>
    <p id="signup-success" class="text-success"></p>
    <p id="signup-error" class="text-danger"></p>
    <!--<form>
        <div class="post-title">
            <input type="text" placeholder="Zip Code">
        </div>
        <div class="post-content">
            <textarea type="text" placeholder="Pace"></textarea>
        </div>
        <button type="submit" class="submit">Submit</button>
    </form>
</div>-->
	  		<div class="signup">
    <h2 class="signup-title">Sign up for beta</h2>
    <p id="signup-success" class="text-success"></p>
    <p id="signup-error" class="text-danger"></p>
    <form class="signup-form form-inline" id="signup-form" role="form" onsubmit="return signup(this)">
    	Weekday Mileage:
        <input class="form-control" name="mileage" type="mileage" placeholder="Weekday Mileage" required>
        <br>
        Time of Day:
        <input class = "form-control" name = "tod" type = "tod" placeholder = "Time of Day" required>
        <br>
        Pace:
        <input class = "form-control" name = "pace" type = "pace" placeholder = "your pace" required>
        <br>
        My Zipcode:
        <input class = "form-control" name = "zip" type = "zip" placeholder = "your zipcode." required>
        <br>
        <button class="btn btn-success" id="signup-button" type="submit" >Join now</button>
    </form>

</div>
	  <script>
		  
				      
    var signupForm = document.getElementById('signup-form');
    var signupSuccess = document.getElementById('signup-success');
    var signupError = document.getElementById('signup-error');
    var signupBtn = document.getElementById('signup-button');
    var onSignupComplete = function(error) {
      signupBtn.disabled = false;
      if (error) {
        signupError.innerHTML = 'Sorry. Could not signup.';
      } else {
        signupSuccess.innerHTML = 'Thanks for signing up!';
        // hide the form
        //signupForm.style.display = 'none';
      }
    };
		  		    console.log("doo");
firebase.auth().onAuthStateChanged(function(user) {
  if (user) {
    // User is signed in.
	    console.log("joo");
var displayName = user.displayName;
		  
firebase.database().ref('/users/' + user.displayName).once('value').then(function(snapshot) {
  var matches = snapshot.val().matches;
  var mileage = snapshot.val().mileage
  console.log("1");
	if(matches == undefined){
		console.log("2");
		firebase.database().ref('users/' + displayName).update({
			matches: "0"
		});
		
	
	}

}); 
  } else {
	  console.log("aoo");
    // No user is signed in.
  }
});
			
		  			  
function signup(formObj) {
        // Store emails to firebase
	var user = firebase.auth().currentUser;
	    var displayName = user.displayName;

        firebase.database().ref('users/' + displayName).update({
        
          mileage: formObj.mileage.value,
          tod: formObj.tod.value,
          zip: formObj.zip.value,
          pace: formObj.pace.value,
        }, onSignupComplete);
        signupBtn.disabled = true;
        return false;
    }

		  
		  
		  
    
</script>
	   
  </body>
</html>
